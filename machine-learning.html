<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>report</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#cs342-machine-learning-summary-report">CS342 Machine Learning Summary Report</a>
<ul>
<li><a href="#abstract">Abstract</a></li>
<li><a href="#problem-setup">Problem setup</a></li>
</ul>
</li>
<li><a href="#part-a.">Part A.</a>
<ul>
<li><a href="#dataset-labels-and-sampling">1. Dataset, labels, and sampling</a></li>
<li><a href="#feature-extraction">2. Feature extraction</a></li>
<li><a href="#traincalibrationtest-partitioning">3. Train/calibration/test partitioning</a></li>
<li><a href="#base-classifier-gaussian-naive-bayes-gnb">4. Base classifier: Gaussian Naive Bayes (GNB)</a></li>
</ul>
</li>
<li><a href="#part-b.">Part B.</a>
<ul>
<li><a href="#population-calibration">5. Population Calibration</a></li>
</ul>
</li>
<li><a href="#part-c.">Part C.</a>
<ul>
<li><a href="#global-calibration-methods">6. Global calibration methods</a></li>
<li><a href="#subgroup-calibration-analysis">7. Subgroup calibration analysis</a></li>
</ul>
</li>
<li><a href="#part-d.">Part D.</a>
<ul>
<li><a href="#multicalibration-procedure">8. Multicalibration procedure</a></li>
<li><a href="#final-integrated-figure">9. Final integrated figure</a></li>
<li><a href="#limitations-and-threats-to-validity">10. Limitations and threats to validity</a></li>
<li><a href="#conclusion">11. Conclusion</a></li>
</ul>
</li>
<li><a href="#tables--figures">Tables & Figures</a></li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="cs342-machine-learning-summary-report">CS342 Machine Learning Summary Report</h1>
<blockquote>
<p>Harmony, 2213811</p>
</blockquote>
<h2 id="abstract">Abstract</h2>
<p>The scope of this project is to explore calibration options within supervised machine learning.  The training, calibration and testing is based upon the CelebA dataset, which provides pictures and their associated labels. Our work produces a Naive Bayes Gaussian prediction upon the data, then explores different modes of calibration: linear, Platt, global isotonic or targeted iterative multicalibration.</p>
<p>We have used a pre-trained base mode (<code>vit_b_16</code> from torchvision.models as <code>vit_base_patch16_224</code> through timm) to extract embeddings. These embeddings are the basis for the rest of our work, as training and calibration will be base on transparent access to both the embeddings and their respective labels, whereas testing will be conducted by predicting an opaque set of labels based on our models and embeddings. In general, the “accuracy” of these findings judge for the quality of the method used to train the model, although different metrics will be explored throughout this report.</p>
<p>The main core of the model implements a Naive Gaussian Bayes (GNB), which was found to be highly miscalibrated despite moderate accuracy.</p>
<p>In terms of global calibration (which considers the entire set of probabilities at once): isotonic gave us the best population calibration. However, when analysing individual groups, some presented extremely inaccurate results.</p>
<p>Thus introducing multicalibration, which aimed to solve subgroup violations iteratively by reducing worst group error, but could be limited by the sample size (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>200</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">n=200{,}000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">200</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">000</span></span></span></span></span>).</p>
<p>We have obtained results:</p>
<p><a id="fn1"></a></p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">GNB</th>
<th align="center">Linear</th>
<th align="center">Platt</th>
<th align="center">Isotonic</th>
<th align="center">Multicalibration</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">MSE</td>
<td align="center">0.2576</td>
<td align="center">0.1920</td>
<td align="center">0.1920</td>
<td align="center">0.1749</td>
<td align="center">0.1730</td>
</tr>
<tr>
<td align="center">ECE</td>
<td align="center">0.2082</td>
<td align="center">0.0287</td>
<td align="center">0.0286</td>
<td align="center">0.0137</td>
<td align="center">0.0098</td>
</tr>
</tbody>
</table><p><em><strong>Figure 1</strong>. Abstract MSE and ECE per model</em></p>
<h2 id="problem-setup">Problem setup</h2>
<h3 id="definition-of-calibration">Definition of Calibration</h3>
<p>Our goal is to predict specific attributes (“Smiling” in the first place) from face images, while building tools to evaluate the quality of predicted probabilities.</p>
<p>Many metrics exist to judge the accuracy of models (such as accuracy). However, these are not sufficient on their own for probabilistic decision-making, as they cannot implement warnings due to low sample size or threshold values without the notion of “calibrated probabilities”.</p>
<p>The calibration of a set of probabilities is about correctness, conditional on the model’s own confidence levels.<br>
A model over-estimating its own results is said to be overconfident, whereas the opposite is under-confident.</p>
<h3 id="primary-objectives">Primary Objectives</h3>
<p>As such, our objective in this coursework will be to analyse the naive calibration results of a GNB and explore further methods for calibration, their implementation and metrics.</p>
<p>The metrics of our models will be mostly represented by their global and subgroup MSE &amp; ECE where relevant. The procedure is as follows:</p>
<ol>
<li>Embeddings extraction, labelling, and partitioning</li>
<li><code>GNB</code> Implementation &amp; Testing</li>
<li><code>ECE</code> &amp; <code>MSE</code> Implementations</li>
<li>Measurement of uncalibrated <code>GNB</code> metrics (scoring)</li>
<li>Implementation, application and scoring of <code>Linear Calibrator</code></li>
<li>Implementation, application and scoring of <code>Platt Scalling</code></li>
<li>Implementation, application and scoring of <code>Isotonic Regression</code></li>
<li>Subgroup (8) labelling extraction</li>
<li>Scoring of subgroup metrics for each <code>GNB</code>, <code>Linear Calibrator</code>, <code>Platt Scalling</code> and <code>Isotonic Regression</code></li>
<li><code>Multicalibration</code> routine implementation <em>(Base: <code>Isotonic</code>, Iterative fix: <code>Platt</code>)</em></li>
<li>Scoring &amp; Analysis of Global (population) <code>Multicalibration</code></li>
<li>Comparative analysis of subgroup-specific metrics</li>
</ol>
<h1 id="part-a.">Part A.</h1>
<h2 id="dataset-labels-and-sampling">1. Dataset, labels, and sampling</h2>
<p>The dataset chosen is CelebA, with target label: <code>Smiling</code>, such that:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext>,&nbsp;if&nbsp;image&nbsp;</mtext><mi>i</mi><mtext>&nbsp;is&nbsp;smiling</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mtext>,&nbsp;if&nbsp;image&nbsp;</mtext><mi>i</mi><mtext>&nbsp;is&nbsp;not&nbsp;smiling</mtext></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
  1 \text{, if image } i \text{ is smiling} \\
  0 \text{, if image } i \text{ is not smiling}
  \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.69em;"><span class="" style="top: -3.69em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord">1</span><span class="mord text"><span class="mord">,&nbsp;if&nbsp;image&nbsp;</span></span><span class="mord mathnormal">i</span><span class="mord text"><span class="mord">&nbsp;is&nbsp;smiling</span></span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mord text"><span class="mord">,&nbsp;if&nbsp;image&nbsp;</span></span><span class="mord mathnormal">i</span><span class="mord text"><span class="mord">&nbsp;is&nbsp;not&nbsp;smiling</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.19em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p>Sampling was done over <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">20{,}000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">20</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">000</span></span></span></span></span> images for speed, and their embeddings were cached. We have only implemented the image selection using the first <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span></span></span></span></span> images, although the implementation of a fully random sampling is trivial. This was done to allow re-using the cached embeddings, which drastically improves speed. This decision might introduce some slight bias, but it is accounted for by recurrent changes of the random partitioning seed.</p>
<blockquote>
<p>Note: the notebook in the state it will be submitted in is configured to run over <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">20{,}000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">20</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">000</span></span></span></span></span> image’s embeddings. However, the data in the rest of the report is based on a sampling of <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">200{,}000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">200</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">000</span></span></span></span></span> images of CelebA, as a bigger dataset allowed our results to be less biased and prone to noise due to small sample size. This does not impact our results in any other way than  making them more reliable.</p>
</blockquote>
<p>We note that <code>y.mean()</code> <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.48</mn></mrow><annotation encoding="application/x-tex">\approx 0.48</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.48</span></span></span></span></span>, which implies that in ideal conditions:</p>
<ul>
<li>“Not smiling” (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>) should achieve about <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>52</mn></mrow><annotation encoding="application/x-tex">52</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">52</span></span></span></span></span>% accuracy</li>
<li>“Smiling” (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>) should achieve about <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>48</mn></mrow><annotation encoding="application/x-tex">48</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">48</span></span></span></span></span>% accuracy</li>
</ul>
<p>The mean also shows that the dataset is close to balanced and calibration metrics are not dominated by extreme imbalance effects. This ensures no bias exists from the data itself before it is used for modelling.</p>
<p>Sample embedding data:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token punctuation">[</span><span class="token punctuation">[</span> 2.0317721  -1.242664   -0.9167001  <span class="token punctuation">..</span>  0.1665741   0.50152385  0.17933488<span class="token punctuation">]</span>
 <span class="token punctuation">[</span>-0.41952235 -0.70657295 -2.7671294  <span class="token punctuation">..</span>  0.21742441  0.8689683   0.6538513 <span class="token punctuation">]</span>
 <span class="token punctuation">[</span> 0.35616362 -0.37349904  0.24071838 <span class="token punctuation">..</span> -1.0324888   0.2589199  -0.6987258 <span class="token punctuation">]</span>
 <span class="token punctuation">..</span>
 <span class="token punctuation">[</span> 0.4644801  -0.18922697 -0.35563466 <span class="token punctuation">..</span> -0.88788974  1.6372997  -1.439859  <span class="token punctuation">]</span>
 <span class="token punctuation">[</span> 0.4666983  -0.7968115  -1.7418057  <span class="token punctuation">..</span>  0.5046505   1.6604819   0.38370264<span class="token punctuation">]</span>
 <span class="token punctuation">[</span> 0.72320235 -1.3794807  -1.1605918  <span class="token punctuation">..</span> -1.1847922   1.1144955   0.7212413 <span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="feature-extraction">2. Feature extraction</h2>
<p>We use a pretrained Vision Transformer as a fixed feature extractor for our purpose (fully equivalent to <code>vit_b_16</code>)</p>
<pre class=" language-py"><code class="prism  language-py">timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">"vit_base_patch16_224"</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
<p>Each image is represented by its embedding vector, resulting in <code>data</code> of dimensions <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>200000</mn><mo separator="true">,</mo><mn>768</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(200000, 768)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">200000</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">768</span><span class="mclose">)</span></span></span></span></span>.</p>
<p>The extraction routine is as follows:</p>
<ul>
<li>Preprocessing: resize, center-crop, normalize with ImageNet mean/std</li>
<li>Forward pass: use <code>forward_features</code>, select CLS token</li>
<li>Batch processing to not starve the GPU due to CPU bottleneck</li>
<li>Caching: save <code>celeba_vit_embeddings.npy</code> to avoid recomputation after each full notebook execution<br>
Note: average runtime on CUDA is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\approx1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span> minute</li>
</ul>
<pre class=" language-py"><code class="prism  language-py"><span class="token comment"># --- CONFIG ---</span>
IMAGE_DIR <span class="token operator">=</span> <span class="token string">"img_align_celeba"</span>
ATTR_FILE <span class="token operator">=</span> <span class="token string">"list_attr_celeba.txt"</span>
EMBEDDINGS_FILE <span class="token operator">=</span> <span class="token string">"celeba_vit_embeddings.npy"</span>
NUM_IMAGES <span class="token operator">=</span> <span class="token number">20000</span>
BATCH_SIZE <span class="token operator">=</span> <span class="token number">64</span>

image_list <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>IMAGE_DIR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>NUM_IMAGES<span class="token punctuation">]</span>
data <span class="token operator">=</span> extract_vit_features<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">==</span> NUM_IMAGES
</code></pre>
<p><a id="fn2"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_1.png" alt="Smile :)"><br>
<em><strong>Figure 2</strong>. Example of smiling label</em></p>
<h2 id="traincalibrationtest-partitioning">3. Train/calibration/test partitioning</h2>
<p>We are given the partition ratios:</p>
<pre class=" language-py"><code class="prism  language-py">TRAINING_RATIO    <span class="token operator">=</span> <span class="token number">0.70</span>
CALIBRATION_RATIO <span class="token operator">=</span> <span class="token number">0.15</span>
TEST_RATIO        <span class="token operator">=</span> <span class="token number">0.15</span>
</code></pre>
<p>The data undergoes stratification on <code>y</code> to maintain prevalence across splits over a fixed random seed for reproducibility of data: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>30</mn><mo separator="true">,</mo><mn>67</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(30, 67)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">30</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">67</span><span class="mclose">)</span></span></span></span></span>.</p>
<p>Note that for the rest of the coursework, to avoid any bias:</p>
<ul>
<li>All training is done on training set only <code>X_train</code></li>
<li>All calibrators are fitted and adjusted on calibration set only <code>X_cal</code></li>
<li>All final metrics are computed on test set only <code>X_test</code></li>
</ul>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtable rowspacing="0.1600em" columnalign="left center right" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mtext>train</mtext></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mstyle mathcolor="#990055"><mn>140000</mn><mstyle mathcolor="default"><mo separator="true">,</mo><mstyle mathcolor="#990055"><mn>768</mn><mstyle mathcolor="default"><mo stretchy="false">)</mo></mstyle></mstyle></mstyle></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mtext>calibration</mtext></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mstyle mathcolor="#990055"><mn>30000</mn><mstyle mathcolor="default"><mo separator="true">,</mo><mstyle mathcolor="#990055"><mn>768</mn><mstyle mathcolor="default"><mo stretchy="false">)</mo></mstyle></mstyle></mstyle></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mtext>test</mtext></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mpadded height="0px" depth="0px"><munder><munder><mrow><mo stretchy="false">(</mo><mstyle mathcolor="#990055"><mn>30000</mn><mstyle mathcolor="default"><mo separator="true">,</mo><mstyle mathcolor="#990055"><mn>768</mn><mstyle mathcolor="default"><mo stretchy="false">)</mo></mstyle></mstyle></mstyle></mstyle></mrow><mo stretchy="true">undefined</mo></munder><msup><mrow></mrow><mtext>(Size,&nbsp;Dimension)</mtext></msup></munder></mpadded></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">
\begin{cases}
\begin{array}{lcr}
X_\text{train} &amp; : &amp; (\color{#990055}140000 \color{default},\color{#990055} 768\color{default}) \\
X_\text{calibration} &amp; : &amp; (\color{#990055}30000\color{default},\color{#990055} 768\color{default})\\
X_\text{test} &amp; : &amp; \smash{\underbrace{(\color{#990055}30000\color{default},\color{#990055} 768\color{default})}_{^{\text{(Size, Dimension)}}}}
\end{array}
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 3.60004em; vertical-align: -1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.49999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -2.49199em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.016em; width: 0.889em;"><svg width="0.889em" height="0.016em" style="width:0.889em" viewBox="0 0 889 16" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V16 H384z M384 0 H504 V16 H384z"></path></svg></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.29201em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.016em; width: 0.889em;"><svg width="0.889em" height="0.016em" style="width:0.889em" viewBox="0 0 889 16" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V16 H384z M384 0 H504 V16 H384z"></path></svg></span></span><span class="" style="top: -4.30002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.05em;"><span class="pstrut" style="height: 4.05em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">train</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">calibration</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">test</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord" style="color: rgb(153, 0, 85);">140000</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: rgb(153, 0, 85);">768</span><span class="mclose">)</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord" style="color: rgb(153, 0, 85);">30000</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: rgb(153, 0, 85);">768</span><span class="mclose">)</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mord"><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.75em;"><span class="" style="top: -1.32658em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.822036em;"><span class="" style="top: -2.82204em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.53571em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">(Size,&nbsp;Dimension)</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.75em;"><span class="svg-align" style="top: -2.102em;"><span class="pstrut" style="height: 3em;"></span><span class="stretchy" style="height: 0.548em; min-width: 1.6em;"><span class="brace-left" style="height: 0.548em;"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"></path></svg></span><span class="brace-center" style="height: 0.548em;"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMidYMin slice"><path d="M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"></path></svg></span><span class="brace-right" style="height: 0.548em;"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"></path></svg></span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord" style="color: rgb(153, 0, 85);">30000</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: rgb(153, 0, 85);">768</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.898em;"><span class=""></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.67342em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<h2 id="base-classifier-gaussian-naive-bayes-gnb">4. Base classifier: Gaussian Naive Bayes (GNB)</h2>
<h3 id="model-assumptions-and-bayes-decision-rule">4.1 Model assumptions and Bayes decision rule</h3>
<p>The Gaussian Naive Bayes classifier operates on:</p>
<ul>
<li>An input embedding vector <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mn>768</mn></msup></mrow><annotation encoding="application/x-tex">x \in \mathbb{R}^{768}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">768</span></span></span></span></span></span></span></span></span></span></span></span></span></li>
<li>A binary class label <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∈</mo><mrow><mn>0</mn><mo separator="true">,</mo><mn>1</mn></mrow></mrow><annotation encoding="application/x-tex">y \in {0,1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span></span></span></span></span></span></li>
</ul>
<p>The model relies on the assumption of conditional independence:</p>
<blockquote>
<p>We assume that, given a class label <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">y=c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">c</span></span></span></span></span>, all embedding dimensions <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">x_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span> are conditionally independent.</p>
</blockquote>
<p>As such, each embedding dimension is modelled independently using a univariate Gaussian distribution:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>∣</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo>∼</mo><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><msubsup><mi>σ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow><mn>2</mn></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">  
x_j \mid y=c \sim \mathcal{N}(\mu_{c,j}, \sigma_{c,j}^2)  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.24722em; vertical-align: -0.383108em;"></span><span class="mord mathcal" style="margin-right: 0.14736em;">N</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span></p>
<p>Under this model, the class prior <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y=c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></span> is estimated via class frequency in the training data. For each class and embedding dimension, the model approximates a mean and variance, which parameterize the Gaussian feature model later used during inference.</p>
<p>Due to the usage and nature of logarithmic functions, ensuring numerical stability was deemed critical and ensured by applying variance smoothing: a small constant <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span> is added to every estimated variance scaled relative to the global variance of the embedding space.</p>
<h3 id="likelihood-and-vectorized-joint-log-likelihood">4.2 Likelihood and vectorized joint log likelihood</h3>
<p>During inference, for a given embedding <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span></span></span></span></span> and class <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">c</span></span></span></span></span>, the <code>GNB</code> assigns a joint log likelihood score (“log” because it is done in log-space), which measures how well <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span></span></span></span></span> fits the Gaussian model learned for that class. The joint log likelihood decomposes into three terms:</p>
<ul>
<li>
<p>A log prior term which accounts for class frequency:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">  
\log P(y=c)  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></span></span></p>
</li>
<li>
<p>A normalization term of Gaussian density:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mo>∑</mo><mi>j</mi></munder><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><msubsup><mi>σ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow><mn>2</mn></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">  
\sum_j \log(2\pi \sigma_{c,j}^2)  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 2.46378em; vertical-align: -1.41378em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right: 0.03588em;">π</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span></p>
</li>
<li>
<p>A quadratic term which measures the squared deviation from the class mean, weighted by inverse variance:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mo>∑</mo><mi>j</mi></munder><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><msub><mi>μ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><msubsup><mi>σ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow><mn>2</mn></msubsup></mfrac></mrow><annotation encoding="application/x-tex">  
\sum_j \frac{(x_j - \mu_{c,j})^2}{\sigma_{c,j}^2}  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 2.90489em; vertical-align: -1.41378em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.49111em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.412972em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.09897em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
</li>
</ul>
<p>Thus giving:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo stretchy="false">)</mo><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence="true">(</mo><munder><mo>∑</mo><mi>j</mi></munder><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><msubsup><mi>σ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow><mn>2</mn></msubsup><mo stretchy="false">)</mo><mo>+</mo><munder><mo>∑</mo><mi>j</mi></munder><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><msub><mi>μ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><msubsup><mi>σ</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow><mn>2</mn></msubsup></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">  
\log P(y=c, x)=
\log P(y=c) -
\frac{1}{2}  
\left(  
\sum_j \log(2\pi \sigma_{c,j}^2)  
+  
\sum_j \frac{(x_j - \mu_{c,j})^2}{\sigma_{c,j}^2}  
\right)  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 3.16378em; vertical-align: -1.41378em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right: 0.03588em;">π</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.49111em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.412972em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.09897em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">)</span></span></span></span></span></span></span></span></p>
<p>Implemented as:</p>
<pre class=" language-py"><code class="prism  language-py">log_det <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> self<span class="token punctuation">.</span>var_<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
quad <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>X_exp <span class="token operator">-</span> mu<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">/</span> var<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

jll <span class="token operator">=</span> log_prior<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>log_det<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> quad<span class="token punctuation">)</span>
</code></pre>
<h3 id="posterior-inference-and-prediction">4.3 Posterior inference and prediction</h3>
<p>Given the joint log likelihood scores for each class <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log P(y=c, x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span>, posterior class probabilities <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo>∣</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y=c \mid x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> are obtained by normalizing these scores across classes.</p>
<p>Thus, in posterior prediction:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo>∣</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mrow><munder><mo>∑</mo><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></munder><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">  
P(y=c \mid x)=
\frac
{\exp(\log P(y=c, x))}  
{\sum_{c'}{ \exp(\log P(y=c', x))}}  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.41271em; vertical-align: -0.98571em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.17827em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mop">exp</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.677892em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop">exp</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.98571em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p>Implemented as:</p>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">predict_proba</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">:</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
    jll <span class="token operator">=</span> self<span class="token punctuation">.</span>_joint_log_likelihood<span class="token punctuation">(</span>X<span class="token punctuation">)</span>

    a <span class="token operator">=</span> jll<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    exp <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>jll <span class="token operator">-</span> a<span class="token punctuation">)</span>
    probs <span class="token operator">=</span> exp <span class="token operator">/</span> exp<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> probs
</code></pre>
<p>Finally, we select the class with the highest joint log likelihood score as prediction (by Bayes):<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>arg</mi><mo>⁡</mo><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mi>c</mi></munder><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mi>c</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">  
\hat{y}(x) = \arg\max_c \log (P(y=c, x))  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.45em; vertical-align: -0.7em;"></span><span class="mop">ar<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.43056em;"><span class="" style="top: -2.4em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop">max</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span></span></span></p>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">:</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
    jll <span class="token operator">=</span> self<span class="token punctuation">.</span>_joint_log_likelihood<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>classes_<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>jll<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<h3 id="metrics-and-binning-ece--mse">4.4 Metrics and binning (ECE &amp; MSE)</h3>
<h4 id="mean-squared-error-mse">4.4.1 Mean Squared Error (MSE)</h4>
<p>The MSE (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\in [0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span>) measures confident wrong predictions (probabilities near 0 or 1 when label is opposite).</p>
<p>Given:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>MSE</mtext><mo>=</mo><mi>E</mi><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\text{MSE} = E[(p(x) - y)^2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">MSE</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.05764em;">E</span><span class="mopen">[(</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.11411em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></span></span></p>
<p>And the estimate:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">S</mi><mi mathvariant="normal">E</mi></mrow><mo stretchy="true">undefined</mo></mover><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo fence="true">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\widehat{\mathrm{MSE}} = \frac{1}{n} \sum_{i=1}^{n} \left( p_i - y_i \right)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.92333em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92333em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathrm">MSE</span></span></span><span class="svg-align" style="top: -3.68333em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.954008em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>We implement the estimation of MSE it as:</p>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">mse</span><span class="token punctuation">(</span>probs<span class="token punctuation">,</span> y_true<span class="token punctuation">)</span><span class="token punctuation">:</span>
    probs <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>probs<span class="token punctuation">)</span>
    y_true <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>y_true<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span>probs <span class="token operator">-</span> y_true<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="expected-calibration-error-ece">4.4.2 Expected Calibration Error (ECE)</h4>
<p>Given predicted probabilities <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span>, the ECE measures the discrepancy between predicted confidence and empirical accuracy by partitioning predictions into equal-width bins over <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span>. Each probability <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> is then assigned to a bin <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">b</span></span></span></span></span>.</p>
<p>Thus:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mtext>ECE</mtext><mo stretchy="true">undefined</mo></mover><mo>≈</mo><munder><mo>∑</mo><mi>b</mi></munder><msub><mi>w</mi><mi>b</mi></msub><mrow><mo fence="true">∣</mo><msub><mi>v</mi><mi>b</mi></msub><mo>−</mo><msub><mtext>acc</mtext><mi>b</mi></msub><mo fence="true">∣</mo></mrow></mrow><annotation encoding="application/x-tex">\widehat{\text{ECE}}\approx\sum_{b}w_b \left| v_b-\text{acc}_b\right|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.92333em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92333em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord text"><span class="mord">ECE</span></span></span><span class="svg-align" style="top: -3.68333em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.35212em; vertical-align: -1.30211em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord text"><span class="mord">acc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">∣</span></span></span></span></span></span></span></p>
<p>In more visual terms, given a set of reliability bins, the ECE measures the mean distance from the model’s curve to the “perfect” <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>45</mn><mi mathvariant="normal">°</mi></mrow><annotation encoding="application/x-tex">45°</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord">45°</span></span></span></span></span> curve.</p>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">ece</span><span class="token punctuation">(</span>probs<span class="token punctuation">,</span> y_true<span class="token punctuation">,</span> n_bins<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Empirical Expected Calibration 
    Error using fixed bin representatives.
    """</span>
    _<span class="token punctuation">,</span> avg_conf<span class="token punctuation">,</span> avg_acc<span class="token punctuation">,</span> bin_counts <span class="token operator">=</span> reliability_curve<span class="token punctuation">(</span>probs<span class="token punctuation">,</span> y_true<span class="token punctuation">,</span> n_bins<span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_true<span class="token punctuation">)</span>

    ece_val <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> conf<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> cnt <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>avg_conf<span class="token punctuation">,</span> avg_acc<span class="token punctuation">,</span> bin_counts<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> cnt <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ece_val <span class="token operator">+=</span> <span class="token punctuation">(</span>cnt <span class="token operator">/</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>conf <span class="token operator">-</span> acc<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span>ece_val<span class="token punctuation">)</span>
</code></pre>
<h1 id="part-b.">Part B.</h1>
<h2 id="population-calibration">5. Population Calibration</h2>
<h3 id="baseline-performance-uncalibrated-gnb">5.1 Baseline performance (uncalibrated GNB)</h3>
<ul>
<li>
<p>Total accuracy: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>73.62</mn></mrow><annotation encoding="application/x-tex">73.62</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">73.62</span></span></span></span></span>% <em>(over argmax)</em></p>
</li>
<li>
<p>Probability statistics:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.1600em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><munder accentunder="true"><mtext>p_cal&nbsp;stats:</mtext><mo stretchy="true">‾</mo></munder></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtable rowspacing="0.1600em" columnalign="left center left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#669900"><mtext>min</mtext></mstyle></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#990055"><mn>0.0000</mn></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#669900"><mtext>mean</mtext></mstyle></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#990055"><mn>0.5228</mn></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#669900"><mtext>max</mtext></mstyle></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#990055"><mn>1.0000</mn></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mover accent="true"><mtext>MSE</mtext><mo stretchy="true">undefined</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2606</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mover accent="true"><mtext>ECE</mtext><mo stretchy="true">undefined</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2112</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Accuracy</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>73.35</mn><mstyle mathcolor="#82664A"><mi mathvariant="normal">%</mi></mstyle></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><munder accentunder="true"><mtext>p_test&nbsp;stats:</mtext><mo stretchy="true">‾</mo></munder></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtable rowspacing="0.1600em" columnalign="left center left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#669900"><mtext>min</mtext></mstyle></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#990055"><mn>0.0000</mn></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#669900"><mtext>mean</mtext></mstyle></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#990055"><mn>0.5233</mn></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#669900"><mtext>max</mtext></mstyle></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mstyle mathcolor="#990055"><mn>1.0000</mn></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mover accent="true"><mtext>MSE</mtext><mo stretchy="true">undefined</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2576</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mover accent="true"><mtext>ECE</mtext><mo stretchy="true">undefined</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2082</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Accuracy</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>73.62</mn><mstyle mathcolor="#82664A"><mi mathvariant="normal">%</mi></mstyle></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{l}
\underline{\text{p\_cal stats:}} \\
\begin{cases}
\begin{array}{lcl}
\color{669900}\text{min} &amp; : &amp; \color{990055}0.0000 \\
\color{669900}\text{mean} &amp; : &amp; \color{990055}0.5228\\
\color{669900}\text{max} &amp; : &amp; \color{990055}1.0000 \\
\widehat{\text{MSE}} &amp; : &amp; 0.2606\\
\widehat{\text{ECE}} &amp; : &amp; 0.2112\\
\text{Accuracy} &amp; : &amp; 73.35\color{82664A}\%
\end{array}
\end{cases} \\ 
\\
\underline{\text{p\_test stats:}} \\
\begin{cases}
\begin{array}{lcl}
\color{669900}\text{min} &amp; : &amp; \color{990055}0.0000 \\
\color{669900}\text{mean} &amp; : &amp; \color{990055}0.5233\\
\color{669900}\text{max} &amp; : &amp; \color{990055}1.0000 \\
\widehat{\text{MSE}} &amp; : &amp; 0.2576\\
\widehat{\text{ECE}} &amp; : &amp; 0.2082\\
\text{Accuracy} &amp; : &amp; 73.62\color{82664A}\%
\end{array}
\end{cases} 
\end{array}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 18.6333em; vertical-align: -9.06666em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 9.56666em;"><span class="" style="top: -14.66em;"><span class="pstrut" style="height: 5.93333em;"></span><span class="mord"><span class="mord underline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.53em;"><span class="pstrut" style="height: 3em;"></span><span class="underline-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">p_cal&nbsp;stats:</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.51em;"><span class=""></span></span></span></span></span></span></span><span class="" style="top: -10.2167em;"><span class="pstrut" style="height: 5.93333em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.85002em;"><span class="" style="top: -1.36599em;"><span class="pstrut" style="height: 3.816em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -1.35799em;"><span class="pstrut" style="height: 3.816em;"></span><span class="" style="height: 1.816em; width: 0.889em;"><svg width="0.889em" height="1.8159999999999998em" style="width:0.889em" viewBox="0 0 889 1816" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z"></path></svg></span></span><span class="" style="top: -3.81601em;"><span class="pstrut" style="height: 3.816em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.95801em;"><span class="pstrut" style="height: 3.816em;"></span><span class="" style="height: 1.816em; width: 0.889em;"><svg width="0.889em" height="1.8159999999999998em" style="width:0.889em" viewBox="0 0 889 1816" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z"></path></svg></span></span><span class="" style="top: -6.76602em;"><span class="pstrut" style="height: 3.816em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.35002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -5.93333em;"><span class="pstrut" style="height: 5.93333em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -6.09333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text" style="color: rgb(102, 153, 0);"><span class="mord" style="color: rgb(102, 153, 0);">min</span></span></span></span><span class="" style="top: -4.89333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text" style="color: rgb(102, 153, 0);"><span class="mord" style="color: rgb(102, 153, 0);">mean</span></span></span></span><span class="" style="top: -3.69333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text" style="color: rgb(102, 153, 0);"><span class="mord" style="color: rgb(102, 153, 0);">max</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92333em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord text"><span class="mord">MSE</span></span></span><span class="svg-align" style="top: -3.68333em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span></span></span></span></span></span><span class="" style="top: -1.12667em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92333em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord text"><span class="mord">ECE</span></span></span><span class="svg-align" style="top: -3.68333em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span></span></span></span></span></span><span class="" style="top: 0.07333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Accuracy</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -6.09333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -4.89333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -3.69333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -1.12667em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: 0.07333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -6.09333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="color: rgb(153, 0, 85);">0.0000</span></span></span><span class="" style="top: -4.89333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="color: rgb(153, 0, 85);">0.5228</span></span></span><span class="" style="top: -3.69333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="color: rgb(153, 0, 85);">1.0000</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0.2606</span></span></span><span class="" style="top: -1.12667em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0.2112</span></span></span><span class="" style="top: 0.07333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">73.35</span><span class="mord" style="color: rgb(130, 102, 74);">%</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -5.94333em;"><span class="pstrut" style="height: 5.93333em;"></span><span class="mord"></span></span><span class="" style="top: -4.74333em;"><span class="pstrut" style="height: 5.93333em;"></span><span class="mord"><span class="mord underline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.61508em;"><span class="" style="top: -2.53em;"><span class="pstrut" style="height: 3em;"></span><span class="underline-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">p_test&nbsp;stats:</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.51em;"><span class=""></span></span></span></span></span></span></span><span class="" style="top: -0.3em;"><span class="pstrut" style="height: 5.93333em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.85002em;"><span class="" style="top: -1.36599em;"><span class="pstrut" style="height: 3.816em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -1.35799em;"><span class="pstrut" style="height: 3.816em;"></span><span class="" style="height: 1.816em; width: 0.889em;"><svg width="0.889em" height="1.8159999999999998em" style="width:0.889em" viewBox="0 0 889 1816" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z"></path></svg></span></span><span class="" style="top: -3.81601em;"><span class="pstrut" style="height: 3.816em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.95801em;"><span class="pstrut" style="height: 3.816em;"></span><span class="" style="height: 1.816em; width: 0.889em;"><svg width="0.889em" height="1.8159999999999998em" style="width:0.889em" viewBox="0 0 889 1816" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z"></path></svg></span></span><span class="" style="top: -6.76602em;"><span class="pstrut" style="height: 3.816em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.35002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -5.93333em;"><span class="pstrut" style="height: 5.93333em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -6.09333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text" style="color: rgb(102, 153, 0);"><span class="mord" style="color: rgb(102, 153, 0);">min</span></span></span></span><span class="" style="top: -4.89333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text" style="color: rgb(102, 153, 0);"><span class="mord" style="color: rgb(102, 153, 0);">mean</span></span></span></span><span class="" style="top: -3.69333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text" style="color: rgb(102, 153, 0);"><span class="mord" style="color: rgb(102, 153, 0);">max</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92333em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord text"><span class="mord">MSE</span></span></span><span class="svg-align" style="top: -3.68333em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span></span></span></span></span></span><span class="" style="top: -1.12667em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92333em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord text"><span class="mord">ECE</span></span></span><span class="svg-align" style="top: -3.68333em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span></span></span></span></span></span><span class="" style="top: 0.07333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Accuracy</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -6.09333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -4.89333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -3.69333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -1.12667em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: 0.07333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.93333em;"><span class="" style="top: -6.09333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="color: rgb(153, 0, 85);">0.0000</span></span></span><span class="" style="top: -4.89333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="color: rgb(153, 0, 85);">0.5233</span></span></span><span class="" style="top: -3.69333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="color: rgb(153, 0, 85);">1.0000</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0.2576</span></span></span><span class="" style="top: -1.12667em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0.2082</span></span></span><span class="" style="top: 0.07333em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">73.62</span><span class="mord" style="color: rgb(130, 102, 74);">%</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.43333em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 9.06666em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p>Min <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\approx0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span> and max <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\approx1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span> imply saturated confidence for some samples</p>
</li>
<li>
<p>Mean predicted probability (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.52</mn></mrow><annotation encoding="application/x-tex">\approx 0.52</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.52</span></span></span></span></span> on test) is higher than overall prevalence (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.48</mn></mrow><annotation encoding="application/x-tex">\approx 0.48</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.48</span></span></span></span></span>), suggesting slight systematic overprediction of “smiling”, but nothing that would indicate any possibly noticeable future bias</p>
</li>
</ul>
<h3 id="baseline-reliability-diagrams">5.2 Baseline reliability diagrams</h3>
<p><a id="fn3"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_2.png" alt="gnb reliability test"></p>
<hr>
<p><img src="https://wurwur.github.io/machine_learning_figs/Figure_2_2.png" alt="gnb reliability cal"><br>
<em><strong>Figure 3</strong>. Uncalibrated GNB reliability diagram on <code>X_test</code> and <code>X_cal</code></em></p>
<p>We notice that the GNB is underconfident to the left of <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">x=0.4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.4</span></span></span></span></span>  and overconfident everywhere else. It presents very few zones of continuous reliability.</p>
<p>Throughout Part B, we will explore different methods of global calibration, implementation and their metrics.</p>
<h1 id="part-c.">Part C.</h1>
<h2 id="global-calibration-methods">6. Global calibration methods</h2>
<h3 id="linear-calibration">6.1 Linear calibration</h3>
<p>Linear regression is done by fitting parameters <code>a,b</code> on the calibration set to minimize squared error between the line and the empirical calibration curve aggregated over predicted values.</p>
<p>The prediction rule is defined as:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>p</mi><mo stretchy="true">undefined</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>clip</mtext><mo stretchy="false">(</mo><mi>a</mi><mo>×</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>b</mi><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\widehat{p}(x) = \text{clip}(a \times p(x) + b, 0, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal">p</span></span><span class="svg-align" style="width: calc(100% - 0.16668em); margin-left: 0.16668em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">clip</span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></span></p>
<p>On our run:</p>
<pre class=" language-py"><code class="prism  language-py">Linear calibrator parameters<span class="token punctuation">:</span> a<span class="token punctuation">:</span> <span class="token number">0.481</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">0.230</span>

Linear Calibration <span class="token operator">+</span> GNB<span class="token punctuation">:</span> 
	<span class="token operator">-</span> MSE<span class="token punctuation">:</span> <span class="token number">0.1920</span> 
	<span class="token operator">-</span> ECE<span class="token punctuation">:</span> <span class="token number">0.0287</span>
</code></pre>
<p><a id="fn4"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_3.png" alt="linear reliability"><br>
<em><strong>Figure 4</strong>. Linearly calibrated reliability diagram on <code>X_test</code></em></p>
<h3 id="platt-scaling">6.2 Platt scaling</h3>
<p>Platt scaling makes use of a sigmoid mapping for calibration:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>p</mi><mo stretchy="true">undefined</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><mi>A</mi><mo>×</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\widehat{p}(x) = \sigma(A \times p(x) + B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal">p</span></span><span class="svg-align" style="width: calc(100% - 0.16668em); margin-left: 0.16668em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.05017em;">B</span><span class="mclose">)</span></span></span></span></span></span></p>
<p>Parameters <code>A,B</code> are defined on calibration set by minimizing negative log-likelihood.</p>
<pre class=" language-py"><code class="prism  language-py">Platt Scaling parameters<span class="token punctuation">:</span> A<span class="token punctuation">:</span> <span class="token number">2.106</span><span class="token punctuation">,</span> B<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.204</span>

Platt Scaling <span class="token operator">+</span> GNB<span class="token punctuation">:</span> 
	<span class="token operator">-</span> MSE<span class="token punctuation">:</span> <span class="token number">0.1920</span> 
	<span class="token operator">-</span> ECE<span class="token punctuation">:</span> <span class="token number">0.0286</span>
</code></pre>
<p><a id="fn5"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_4.png" alt="platt reliability"><br>
<em><strong>Figure 5</strong>. Platt calibrated reliability diagram on <code>X_test</code></em></p>
<blockquote>
<p>Note: our implementation is functionally equivalent to scikit-learn’s sigmoid calibration, but less opaque.</p>
</blockquote>
<h3 id="isotonic-regression">6.3 Isotonic regression</h3>
<p>Isotonic regression is defined as:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>p</mi><mo stretchy="true">undefined</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\widehat{p}(x) = g(p(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal">p</span></span><span class="svg-align" style="width: calc(100% - 0.16668em); margin-left: 0.16668em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"><svg width="100%" height="0.24em" viewBox="0 0 1062 239" preserveAspectRatio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span></span></span></p>
<p>With <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span></span></span></span></span> fitted on calibration set to best match labels under monotonicity constraint.</p>
<pre class=" language-py"><code class="prism  language-py">Isotonic Calibration <span class="token operator">+</span> GNB<span class="token punctuation">:</span> 
	<span class="token operator">-</span> MSE<span class="token punctuation">:</span> <span class="token number">0.1749</span> 
	<span class="token operator">-</span> ECE<span class="token punctuation">:</span> <span class="token number">0.0137</span>
</code></pre>
<p><a id="fn6"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_5.png" alt="isotonic reliability"><br>
<em><strong>Figure 6</strong>. Isotonic calibrated reliability diagram on <code>X_test</code></em></p>
<h3 id="global-calibration-conclusion">6.4 Global Calibration Conclusion</h3>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">GNB</th>
<th align="center">Linear</th>
<th align="center">Platt</th>
<th align="center">Isotonic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">MSE</td>
<td align="center">0.2576</td>
<td align="center">0.1920</td>
<td align="center">0.1920</td>
<td align="center">0.1749</td>
</tr>
<tr>
<td align="center">ECE</td>
<td align="center">0.2082</td>
<td align="center">0.0287</td>
<td align="center">0.0286</td>
<td align="center">0.0137</td>
</tr>
</tbody>
</table><p><em><strong>Figure 1</strong>. Abstract MSE and ECE per model</em></p>
<ul>
<li><code>Isotonic</code> dominates in MSE and ECE in this run</li>
<li><code>GNB</code>, <code>Linear</code> and <code>Platt</code> show extreme regions of under-confidence then over-confidence</li>
<li><code>Linear</code> and <code>Platt</code> yield similar metrics yield similar MSE and ECE here (likely because base <code>p</code> is already near-linearly transformable after binning)</li>
<li>Massive ECE reduction from <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.208</mn></mrow><annotation encoding="application/x-tex">\approx0.208</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.208</span></span></span></span></span> (<code>GNB</code>) to <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.014</mn></mrow><annotation encoding="application/x-tex">\approx0.014</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.014</span></span></span></span></span> (<code>Isotonic</code>: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mo>+</mo><mn>93</mn><mi mathvariant="normal">%</mi></mstyle></mrow><annotation encoding="application/x-tex">\, \color{green}+93\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">93%</span></span></span></span></span>) indicates that calibration correction is the main story, but not accuracy, as the drop in MSE (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mo>+</mo><mn>32</mn><mi mathvariant="normal">%</mi></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}+32\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">32%</span></span></span></span></span>) is less pronounced.</li>
</ul>
<h2 id="subgroup-calibration-analysis">7. Subgroup calibration analysis</h2>
<p>This part aims at exploring how global calibration models impact a multitude of subgroups individually. We work on the same previous set of probabilities:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtable rowspacing="0.1600em" columnalign="left left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Uncalibrated&nbsp;GNB</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>p_test</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Linearly&nbsp;calibrated</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>p_test_lin</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Platt&nbsp;scaling</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>p_test_platt</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Isotonic&nbsp;calibrated</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>p_test_iso</mtext></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
\begin{array}{lll}
    \text{Uncalibrated GNB}&amp;: &amp; \text{p\_test} \\
    \text{Linearly calibrated}&amp;: &amp; \text{p\_test\_lin} \\
    \text{Platt scaling} &amp; : &amp; \text{p\_test\_platt} \\
    \text{Isotonic calibrated}&amp;  : &amp; \text{p\_test\_iso}
\end{array}\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 4.80004em; vertical-align: -2.15002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65002em;"><span class="" style="top: -1.89999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -1.89199em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.616em; width: 0.889em;"><svg width="0.889em" height="0.6160000000000001em" style="width:0.889em" viewBox="0 0 889 616" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V616 H384z M384 0 H504 V616 H384z"></path></svg></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.29201em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.616em; width: 0.889em;"><svg width="0.889em" height="0.6160000000000001em" style="width:0.889em" viewBox="0 0 889 616" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V616 H384z M384 0 H504 V616 H384z"></path></svg></span></span><span class="" style="top: -4.90002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.65em;"><span class="pstrut" style="height: 4.65em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Uncalibrated&nbsp;GNB</span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Linearly&nbsp;calibrated</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Platt&nbsp;scaling</span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Isotonic&nbsp;calibrated</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">p_test</span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">p_test_lin</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">p_test_platt</span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">p_test_iso</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<pre class=" language-py"><code class="prism  language-py">models <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"Uncalibrated GNB"</span><span class="token punctuation">:</span> p_test<span class="token punctuation">,</span>
    <span class="token string">"Linearly calibrated"</span><span class="token punctuation">:</span> p_test_lin<span class="token punctuation">,</span>
    <span class="token string">"Platt scaling"</span><span class="token punctuation">:</span> p_test_platt<span class="token punctuation">,</span>
    <span class="token string">"Isotonic calibrated"</span><span class="token punctuation">:</span> p_test_iso<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="subgroups-definition-and-distribution">7.1 Subgroups definition and distribution</h3>
<p>We have the following <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">8</span></span></span></span></span> subgroups:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtable rowspacing="0.1600em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Male</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Young</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Blond_Hair</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>Wearing_Hat</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">:</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases} 
  \begin{array}{l}
    \text{Male} &amp;:&amp; \{0,1\} \\
	\text{Young}&amp;:&amp; \{0,1\} \\ 
	\text{Blond\_Hair}&amp;:&amp; \{0,1\} \\
	\text{Wearing\_Hat}&amp;:&amp; \{0,1\} \end{array} \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 4.80004em; vertical-align: -2.15002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65002em;"><span class="" style="top: -1.89999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -1.89199em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.616em; width: 0.889em;"><svg width="0.889em" height="0.6160000000000001em" style="width:0.889em" viewBox="0 0 889 616" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V616 H384z M384 0 H504 V616 H384z"></path></svg></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.29201em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.616em; width: 0.889em;"><svg width="0.889em" height="0.6160000000000001em" style="width:0.889em" viewBox="0 0 889 616" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V616 H384z M384 0 H504 V616 H384z"></path></svg></span></span><span class="" style="top: -4.90002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.65em;"><span class="pstrut" style="height: 4.65em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Male</span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Young</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Blond_Hair</span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Wearing_Hat</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p>With sizes distribution (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>200</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">n=200{,}000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">200</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">000</span></span></span></span></span>; seed dependant):</p>
<p><a id="fn7"></a></p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">Blond_Hair=0</th>
<th align="center">Blond_Hair=1</th>
<th align="center">Male=0</th>
<th align="center">Male=1</th>
<th align="center">Wearing_Hat=0</th>
<th align="center">Wearing_Hat=1</th>
<th align="center">Young=0</th>
<th align="center">Young=1</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Size</strong></td>
<td align="center">25506</td>
<td align="center">4494</td>
<td align="center">17557</td>
<td align="center">12443</td>
<td align="center">28577</td>
<td align="center">1423</td>
<td align="center">6879</td>
<td align="center">23121</td>
</tr>
</tbody>
</table><p><em><strong>Figure 7</strong>. Subgroup size distribution</em></p>
<blockquote>
<p>We note that Wearing_Hat=1 is minimal on its own and relative to other values.</p>
</blockquote>
<h3 id="subgroups-metrics-across-global-models">7.2 Subgroups metrics across global models</h3>
<blockquote>
<p>Each model (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">m</span></span></span></span></span>) displays next to each subgroup’s metric value (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>) (accuracy, MSE, and ECE) a scaled and normalized rate of “change” relative to the uncalibrated GNB baseline, reflecting how much a given subgroup improves compared to the typical improvement achieved by the model.</p>
<p>In other terms, given (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mrow><mi>m</mi><mo separator="true">,</mo><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">v_{m,g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>) the metric value of a model (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">m</span></span></span></span></span>) for a subgroup (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span></span></span></span></span>) over (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal">G</span></span></span></span></span>), and (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mrow><mover accent="true"><mi>m</mi><mo>˙</mo></mover><mo separator="true">,</mo><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">v_{\dot m,g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">m</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.13889em;"><span class="mord mtight">˙</span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>) the corresponding metric for the uncalibrated GNB, the rate of change is defined as:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>r</mi><mrow><mi>m</mi><mo separator="true">,</mo><mi>g</mi></mrow></msub><mo>=</mo><msub><mi>σ</mi><mi>v</mi></msub><mfrac><mrow><msub><mi>v</mi><mrow><mover accent="true"><mi>m</mi><mo>˙</mo></mover><mo separator="true">,</mo><mi>g</mi></mrow></msub><mo>−</mo><msub><mi>v</mi><mrow><mi>m</mi><mo separator="true">,</mo><mi>g</mi></mrow></msub></mrow><mrow><msub><mi>v</mi><mrow><mover accent="true"><mi>m</mi><mo>˙</mo></mover><mo separator="true">,</mo><mi>g</mi></mrow></msub><mo>+</mo><mi>ϵ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> r_{m,g} = \sigma_v  \frac{v_{\dot m,g}-v_{m,g}}{v_{\dot m,g}+\epsilon}  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.23244em; vertical-align: -0.972108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.26033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">m</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.13889em;"><span class="mord mtight">˙</span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathnormal">ϵ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">m</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.13889em;"><span class="mord mtight">˙</span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.972108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p>where (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>v</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma_v = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>) for ECE and MSE (where lower is better), and (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>v</mi></msub><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma_v = -1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">−</span><span class="mord">1</span></span></span></span></span>) for accuracy (higher is better).</p>
<p>The mean rate of change for model (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">m</span></span></span></span></span>) across all subgroups is then:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mover accent="true"><mi>r</mi><mo>ˉ</mo></mover><mi>m</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">∣</mi><mi>G</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><munder><mo>∑</mo><mrow><mi>g</mi><mo>∈</mo><mi>G</mi></mrow></munder><msub><mi>r</mi><mrow><mi>m</mi><mo separator="true">,</mo><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bar r_m =\frac{1}{|G|}   \sum_{g\in G} r_{m,g}  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.71778em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.56778em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.75188em; vertical-align: -1.43044em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord mathnormal">G</span><span class="mord">∣</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight">G</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.43044em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></p>
<p>Thus, the scaled rate of change for subgroup (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span></span></span></span></span>) under model (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">m</span></span></span></span></span>) is given by:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mrow><mi>m</mi><mo separator="true">,</mo><mi>g</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>r</mi><mrow><mi>m</mi><mo separator="true">,</mo><mi>g</mi></mrow></msub><mo>−</mo><msub><mover accent="true"><mi>r</mi><mo>ˉ</mo></mover><mi>m</mi></msub></mrow><mrow><mi mathvariant="normal">∣</mi><msub><mover accent="true"><mi>r</mi><mo>ˉ</mo></mover><mi>m</mi></msub><mi mathvariant="normal">∣</mi><mo>+</mo><mi>ϵ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">s_{m,g} =\frac{r_{m,g}-\bar r_m}{|\bar r_m|+\epsilon}  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.19633em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.26033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.56778em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathnormal">ϵ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.56778em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p>With (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span>) a small non-null constant</p>
<p>Positive values of (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>m</mi><mo separator="true">,</mo><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">s_{m,g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>) indicate that the subgroup improves more than the model’s average improvement, while negative values indicate weaker-than-average improvement even when the subgroup’s metric is improving comparatively to the GNB.</p>
</blockquote>
<h4 id="uncalibrated-gnb">7.2.1 Uncalibrated GNB</h4>
<p><a id="fn8"></a></p>

<table>
<thead>
<tr>
<th align="left">Group</th>
<th align="center">Size</th>
<th align="center">Accuracy</th>
<th align="center">ECE</th>
<th align="center">MSE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Blond_Hair=0</td>
<td align="center">25506</td>
<td align="center">0.7359</td>
<td align="center">0.2082</td>
<td align="center">0.2579</td>
</tr>
<tr>
<td align="left">Blond_Hair=1</td>
<td align="center">4494</td>
<td align="center">0.7381</td>
<td align="center">0.2092</td>
<td align="center">0.2562</td>
</tr>
<tr>
<td align="left">Male=0</td>
<td align="center">17557</td>
<td align="center">0.7332</td>
<td align="center">0.2119</td>
<td align="center">0.2605</td>
</tr>
<tr>
<td align="left">Male=1</td>
<td align="center">12443</td>
<td align="center">0.7405</td>
<td align="center">0.2033</td>
<td align="center">0.2536</td>
</tr>
<tr>
<td align="left">Wearing_Hat=0</td>
<td align="center">28577</td>
<td align="center">0.7374</td>
<td align="center">0.2069</td>
<td align="center">0.2563</td>
</tr>
<tr>
<td align="left">Wearing_Hat=1</td>
<td align="center">1423</td>
<td align="center">0.7112</td>
<td align="center">0.2380</td>
<td align="center">0.2848</td>
</tr>
<tr>
<td align="left">Young=0</td>
<td align="center">6879</td>
<td align="center">0.7417</td>
<td align="center">0.2030</td>
<td align="center">0.2525</td>
</tr>
<tr>
<td align="left">Young=1</td>
<td align="center">23121</td>
<td align="center">0.7346</td>
<td align="center">0.2097</td>
<td align="center">0.2592</td>
</tr>
</tbody>
</table><p><em><strong>Figure 8</strong>. Uncalibrated GNB subgroup metrics</em></p>
<hr>
<h4 id="linearly-calibrated">7.2.2 Linearly calibrated</h4>
<p><a id="fn9"></a></p>

<table>
<thead>
<tr>
<th align="left">Group</th>
<th align="center">Size</th>
<th align="center">Accuracy</th>
<th align="center">ECE</th>
<th align="center">MSE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Blond_Hair=0</td>
<td align="center">25506</td>
<td align="center">0.7360 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>2.06</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+2.06}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">2.06</span></span></span></span></span></span>)</td>
<td align="center">0.0271 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.03</span></span></span></span></span></span>)</td>
<td align="center">0.1922 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Blond_Hair=1</td>
<td align="center">4494</td>
<td align="center">0.7390 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>7.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+7.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">7.01</span></span></span></span></span></span>)</td>
<td align="center">0.0395 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.04</span></span></span></span></span></span>)</td>
<td align="center">0.1908 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=0</td>
<td align="center">17557</td>
<td align="center">0.7340 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>6.42</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+6.42}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">6.42</span></span></span></span></span></span>)</td>
<td align="center">0.0291 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.02</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.02}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.02</span></span></span></span></span></span>)</td>
<td align="center">0.1934 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.01</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=1</td>
<td align="center">12443</td>
<td align="center">0.7400 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>2.25</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-2.25}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">2.25</span></span></span></span></span></span>)</td>
<td align="center">0.0295 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.01</span></span></span></span></span></span>)</td>
<td align="center">0.1900 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.02</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.02}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.02</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=0</td>
<td align="center">28577</td>
<td align="center">0.7379 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>3.84</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+3.84}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">3.84</span></span></span></span></span></span>)</td>
<td align="center">0.0333 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.01</span></span></span></span></span></span>)</td>
<td align="center">0.1911 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=1</td>
<td align="center">1423</td>
<td align="center">0.7084 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>18.70</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-18.70}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">18.70</span></span></span></span></span></span>)</td>
<td align="center">0.0677 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.15</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.15</span></span></span></span></span></span>)</td>
<td align="center">0.2096 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.04</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=0</td>
<td align="center">6879</td>
<td align="center">0.7411 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>2.91</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-2.91}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">2.91</span></span></span></span></span></span>)</td>
<td align="center">0.0071 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.14</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.14}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.14</span></span></span></span></span></span>)</td>
<td align="center">0.1907 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.04</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=1</td>
<td align="center">23121</td>
<td align="center">0.7351 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>4.52</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+4.52}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">4.52</span></span></span></span></span></span>)</td>
<td align="center">0.0354 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.01</span></span></span></span></span></span>)</td>
<td align="center">0.1924 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.01</span></span></span></span></span></span>)</td>
</tr>
</tbody>
</table><p><em><strong>Figure 9</strong>. Linearly calibrated subgroup metrics</em></p>
<hr>
<h4 id="platt-scaling-1">7.2.3 Platt scaling</h4>
<p><a id="fn10"></a></p>

<table>
<thead>
<tr>
<th align="left">Group</th>
<th align="center">Size</th>
<th align="center">Accuracy</th>
<th align="center">ECE</th>
<th align="center">MSE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Blond_Hair=0</td>
<td align="center">25506</td>
<td align="center">0.7360 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>1.68</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+1.68}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">1.68</span></span></span></span></span></span>)</td>
<td align="center">0.0269 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.03</span></span></span></span></span></span>)</td>
<td align="center">0.1923 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Blond_Hair=1</td>
<td align="center">4494</td>
<td align="center">0.7390 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>6.15</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+6.15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">6.15</span></span></span></span></span></span>)</td>
<td align="center">0.0394 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.04</span></span></span></span></span></span>)</td>
<td align="center">0.1907 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=0</td>
<td align="center">17557</td>
<td align="center">0.7340 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>5.64</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+5.64}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">5.64</span></span></span></span></span></span>)</td>
<td align="center">0.0290 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.02</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.02}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.02</span></span></span></span></span></span>)</td>
<td align="center">0.1934 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.01</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=1</td>
<td align="center">12443</td>
<td align="center">0.7399 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>2.24</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-2.24}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">2.24</span></span></span></span></span></span>)</td>
<td align="center">0.0293 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.01</span></span></span></span></span></span>)</td>
<td align="center">0.1901 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.02</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.02}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.02</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=0</td>
<td align="center">28577</td>
<td align="center">0.7378 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>3.23</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+3.23}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">3.23</span></span></span></span></span></span>)</td>
<td align="center">0.0331 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
<td align="center">0.1911 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=1</td>
<td align="center">1423</td>
<td align="center">0.7084 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>15.88</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-15.88}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">15.88</span></span></span></span></span></span>)</td>
<td align="center">0.0676 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.15</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.15</span></span></span></span></span></span>)</td>
<td align="center">0.2098 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.03</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=0</td>
<td align="center">6879</td>
<td align="center">0.7411 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>2.35</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-2.35}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">2.35</span></span></span></span></span></span>)</td>
<td align="center">0.0076 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.14</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.14}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.14</span></span></span></span></span></span>)</td>
<td align="center">0.1907 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.04</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=1</td>
<td align="center">23121</td>
<td align="center">0.7350 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>3.77</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+3.77}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">3.77</span></span></span></span></span></span>)</td>
<td align="center">0.0351 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.01</span></span></span></span></span></span>)</td>
<td align="center">0.1924 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.01</span></span></span></span></span></span>)</td>
</tr>
</tbody>
</table><p><em><strong>Figure 10</strong>. Platt calibrated subgroup metrics</em></p>
<h4 id="isotonic-calibrated">7.2.4 Isotonic calibrated</h4>
<p><a id="fn11"></a></p>

<table>
<thead>
<tr>
<th align="left">Group</th>
<th align="center">Size</th>
<th align="center">Accuracy</th>
<th align="center">ECE</th>
<th align="center">MSE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Blond_Hair=0</td>
<td align="center">25506</td>
<td align="center">0.7432 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.46</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.46}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.46</span></span></span></span></span></span>)</td>
<td align="center">0.0106 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.15</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.15</span></span></span></span></span></span>)</td>
<td align="center">0.1764 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Blond_Hair=1</td>
<td align="center">4494</td>
<td align="center">0.7623 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>3.84</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+3.84}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">3.84</span></span></span></span></span></span>)</td>
<td align="center">0.0492 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.07</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.07}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.07</span></span></span></span></span></span>)</td>
<td align="center">0.1659 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.12</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.12}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.12</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=0</td>
<td align="center">17557</td>
<td align="center">0.7522 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>2.83</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+2.83}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">2.83</span></span></span></span></span></span>)</td>
<td align="center">0.0301 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.04</span></span></span></span></span></span>)</td>
<td align="center">0.1722 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.08</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.08}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.08</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=1</td>
<td align="center">12443</td>
<td align="center">0.7373 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>1.64</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-1.64}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">1.64</span></span></span></span></span></span>)</td>
<td align="center">0.0258 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.06</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.06}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.06</span></span></span></span></span></span>)</td>
<td align="center">0.1786 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.06</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.06}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.06</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=0</td>
<td align="center">28577</td>
<td align="center">0.7493 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>1.38</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+1.38}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">1.38</span></span></span></span></span></span>)</td>
<td align="center">0.0146 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.12</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.12}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.12</span></span></span></span></span></span>)</td>
<td align="center">0.1731 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.03</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=1</td>
<td align="center">1423</td>
<td align="center">0.6796 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>7.55</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-7.55}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">7.55</span></span></span></span></span></span>)</td>
<td align="center">0.1382 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.49</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.49}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.49</span></span></span></span></span></span>)</td>
<td align="center">0.2107 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.17</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.17}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.17</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=0</td>
<td align="center">6879</td>
<td align="center">0.7425 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.83</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.83}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.83</span></span></span></span></span></span>)</td>
<td align="center">0.0213 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.08</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.08}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.08</span></span></span></span></span></span>)</td>
<td align="center">0.1747 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.02</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.02}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.02</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=1</td>
<td align="center">23121</td>
<td align="center">0.7471 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>1.51</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+1.51}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">1.51</span></span></span></span></span></span>)</td>
<td align="center">0.0163 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.12</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.12}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.12</span></span></span></span></span></span>)</td>
<td align="center">0.1749 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.03</span></span></span></span></span></span>)</td>
</tr>
</tbody>
</table><p><em><strong>Figure 11</strong>. Isotonic calibrated subgroup metrics</em></p>
<h3 id="subgroup-ece-and-reliability">7.3 Subgroup ECE and reliability</h3>
<p><a id="fn12"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_6.png" alt="subgroup ece bars"><br>
<em><strong>Figure 12</strong>. Subgroup calibration ECE per model</em></p>
<p>Displayed in <a href="#fn12">Fig. 12</a> is a more visual way of understanding the impact on ECE of each subgroup global calibration has per model. Once again, corroborating our thesis of isotonic being on average the best performer, but with outlier subgroups such as <code>Wearing_Hat=1</code>.</p>
<p><a id="fn13"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_7.png" alt="subgroup reliabiility"><br>
<em><strong>Figure 13</strong>. Subgroup reliability diagram on <code>X_test</code></em></p>
<p>The reliability curve of each subgroup per model further accentuates that point.</p>
<h3 id="global-calibrations-impact-on-subgroup-calibration">7.4 Global calibration’s impact on subgroup calibration</h3>
<p>We note that <code>Global isotonic</code>'s calibration, despite showing great population ECE, does not distribute those improvements uniformly across all subgroups. Its performance can stagnate or worsen for rare subgroups over specific constraints, as we can see with subgroup <code>Wearing_Hat=1</code>.</p>
<p>As for <code>Linear</code> and <code>Platt</code> global calibrations, they both substantially improve subgroup ECE relative to the uncalibrated model. However, their impact remains limited due to their nature (linear or sigmoid transformations).</p>
<p>Therefore, we can infer that improving population calibration does not guarantee uniformly improved subgroup calibration. Instead, it appears that worst-case subgroup behaviour depends on multiple factors relative to the distribution of the subgroup itself within the dataset. In our case, we can suppose that subgroup size is the dominant limiting factor, justifying the shift between global calibration and subgroup distributions.</p>
<h1 id="part-d.">Part D.</h1>
<h2 id="multicalibration-procedure">8. Multicalibration procedure</h2>
<h3 id="motivation">8.1 Motivation</h3>
<p>To solve the issue of uneven subgroup calibration, we take a targeted “multicalibration” iterative approach to calibration: we start with the isotonic probabilities (shown to have the best overall metrics) and iteratively identify the worst subgroup <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">g^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.883136em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.688696em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span> and apply calibration specific to <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">g^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.883136em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.688696em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<h3 id="algorithmic-specifications">8.2 Algorithmic specifications</h3>
<ul>
<li>Start from the global <code>Isotonic</code> calibrated probabilities
<ul>
<li>We selected the isotonic calibrated probabilities as they are observed to have the best overall metrics.</li>
</ul>
</li>
<li>Iterate for at most <code>MAX_ITERS</code> iterations (or <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ECE</mtext><mo stretchy="false">(</mo><msup><mi>g</mi><mo>∗</mo></msup><mo stretchy="false">)</mo><mo>&lt;</mo><mn>0.03</mn></mrow><annotation encoding="application/x-tex">\text{ECE}(g^*) &lt; 0.03</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">ECE</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.688696em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.03</span></span></span></span></span>):
<ul>
<li>
<p>Identify the worst-calibrated subgroup on the calibration set:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>g</mi><mo>∗</mo></msup><mo>=</mo><mi>arg</mi><mo>⁡</mo><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mi>g</mi><mo>∈</mo><mi>G</mi></mrow></munder><mrow><mo fence="true">[</mo><mtext>ECE</mtext><mo stretchy="false">(</mo><mi>g</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">g^* = \arg\max_{g \in G}\left[ \text{ECE}(g)\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.933136em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.738696em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.63044em; vertical-align: -0.880439em;"></span><span class="mop">ar<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.43056em;"><span class="" style="top: -2.35567em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03588em;">g</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight">G</span></span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop">max</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.880439em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mord text"><span class="mord">ECE</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span></span></span></span></p>
</li>
<li>
<p>Fit <code>Platt</code> scaling parameters <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A, B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.05017em;">B</span><span class="mclose">)</span></span></span></span></span> using subgroup <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">g^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.883136em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.688696em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span>'s predictions over <code>X_cal</code>/<code>y_cal</code></p>
<ul>
<li>Platt scaling is used because its parametric form provides stable calibration when fitted on small subgroups, whereas non-parametric methods such as isotonic regression are prone to overfitting</li>
</ul>
</li>
<li>
<p>Update predicted probabilities in place for subgroup <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">g^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.883136em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.688696em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span> over both <code>X_cal</code> and <code>X_test</code>using the fitted <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A, B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.05017em;">B</span><span class="mclose">)</span></span></span></span></span></p>
</li>
<li>
<p>Record the history of population ECE and MSE, as well as the ID and ECE of the worst-performing subgroup at each iteration</p>
</li>
</ul>
</li>
</ul>
<h3 id="iteration-history-metrics-and-interpretation">8.3 Iteration history, metrics and interpretation</h3>
<p><a id="fn14"></a></p>

<table>
<thead>
<tr>
<th align="center">Iteration n°</th>
<th align="center">Population MSE</th>
<th align="center">Population ECE</th>
<th align="center">Worst Group ID</th>
<th align="center">Worst Group ECE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">0.174860</td>
<td align="center">0.013743</td>
<td align="center">Wearing_Hat=1</td>
<td align="center">0.138194</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">0.173503</td>
<td align="center">0.013400</td>
<td align="center">Wearing_Hat=1</td>
<td align="center">0.020134</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">0.173522</td>
<td align="center">0.014170</td>
<td align="center">Blond_Hair=1</td>
<td align="center">0.051113</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">0.172941</td>
<td align="center">0.009760</td>
<td align="center">Wearing_Hat=1</td>
<td align="center">0.029269</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">0.172965</td>
<td align="center">0.009913</td>
<td align="center">Wearing_Hat=1</td>
<td align="center">0.033556</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">0.172990</td>
<td align="center">0.009847</td>
<td align="center">Wearing_Hat=1</td>
<td align="center">0.034259</td>
</tr>
</tbody>
</table><p><em><strong>Figure 14</strong>. Multicalibration history across iterations</em></p>
<p><a id="fn15"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_8.png" alt="iteration multical evolution"><br>
<em><strong>Figure 15</strong>. Multicalibration ECE evolution over iterations</em></p>
<p>As each iteration of the multicalibration procedure targets only <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">g^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.883136em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.688696em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span>, although we ensure that <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">g^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.883136em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.688696em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span> improves, we notice that other subgroups’ metrics are impacted in unpredictable ways. This dynamic can be explained because of probabilities overlap across subgroup, thus implying that the worst-group identity can vary across iterations. This dynamic also explains why population MSE/ECE fluctuates, as they are reflecting trade-offs introduced by targeted subgroup recalibration.</p>
<p>We notice that worst-group ECE drops sharply after the first correction (likely as it drastically improves <code>Wearing_Hat=1</code>, the main outlier in our previous global calibration).</p>
<p>Finally, in the case of a dataset presenting a very small subgroup or noisy, the multicalibration process will be very limited, as each iteration aiming at calibrating that subgroup specifically will greatly degrade the quality of all others.</p>
<p><a id="fn16"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_9.png" alt="multical reliability"><br>
<em><strong>Figure 16</strong>. Multicalibration reliability diagram on <code>X_test</code></em></p>
<h3 id="multicalibrated-vs-globally-calibrated">8.4 Multicalibrated vs globally calibrated</h3>
<p>As previously observed, global calibration methods improve significantly population calibration but have limited influence on specific subgroups [<a href="#fn1">1</a>, <a href="#fn12">12</a>]. In particular, isotonic calibration exhibits its worst behaviour on the rare subgroup <code>Wearing_Hat=1</code>, with ECE <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.14</mn></mrow><annotation encoding="application/x-tex">\approx0.14</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.14</span></span></span></span></span> (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.49</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.49}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.49</span></span></span></span></span></span>) [<a href="#fn11">11</a>].</p>
<p><a id="fn17"></a></p>

<table>
<thead>
<tr>
<th align="left">Group</th>
<th align="center">Size</th>
<th align="center">Accuracy</th>
<th align="center">ECE</th>
<th align="center">MSE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Blond_Hair=0</td>
<td align="center">25506</td>
<td align="center">0.7468 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.36</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.36}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.36</span></span></span></span></span></span>)</td>
<td align="center">0.0092 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.04</span></span></span></span></span></span>)</td>
<td align="center">0.1749 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.03</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Blond_Hair=1</td>
<td align="center">4494</td>
<td align="center">0.7739 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>1.08</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+1.08}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">1.08</span></span></span></span></span></span>)</td>
<td align="center">0.0211 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.02</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.02}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.02</span></span></span></span></span></span>)</td>
<td align="center">0.1624 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.10</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.10</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=0</td>
<td align="center">17557</td>
<td align="center">0.7567 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.38</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.38}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.38</span></span></span></span></span></span>)</td>
<td align="center">0.0233 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.03</span></span></span></span></span></span>)</td>
<td align="center">0.1705 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.04</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Male=1</td>
<td align="center">12443</td>
<td align="center">0.7425 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.88</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.88}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.88</span></span></span></span></span></span>)</td>
<td align="center">0.0149 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.01</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.01}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.01</span></span></span></span></span></span>)</td>
<td align="center">0.1765 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.09</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.09}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.09</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=0</td>
<td align="center">28577</td>
<td align="center">0.7514 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.19</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.19}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.19</span></span></span></span></span></span>)</td>
<td align="center">0.0093 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.04</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.04}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.04</span></span></span></span></span></span>)</td>
<td align="center">0.1725 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.02</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.02}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.02</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Wearing_Hat=1</td>
<td align="center">1423</td>
<td align="center">0.7400 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.74</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.74}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.74</span></span></span></span></span></span>)</td>
<td align="center">0.0343 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.07</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.07}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.07</span></span></span></span></span></span>)</td>
<td align="center">0.1833 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.07</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.07}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.07</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=0</td>
<td align="center">6879</td>
<td align="center">0.7447 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.82</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.82}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.82</span></span></span></span></span></span>)</td>
<td align="center">0.0173 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
<td align="center">0.1739 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.07</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.07}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.07</span></span></span></span></span></span>)</td>
</tr>
<tr>
<td align="left">Young=1</td>
<td align="center">23121</td>
<td align="center">0.7526 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.06</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.06}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.06</span></span></span></span></span></span>)</td>
<td align="center">0.0117 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="green"><mrow><mo>+</mo><mn>0.03</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{green}{+0.03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: green;"><span class="mord" style="color: green;">+</span><span class="mord" style="color: green;">0.03</span></span></span></span></span></span>)</td>
<td align="center">0.1727 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\,+0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">+</span><span class="mord">0</span></span></span></span></span>)</td>
</tr>
</tbody>
</table><p><em><strong>Figure 17</strong>. Multicalibration subgroup metrics</em></p>
<p>Multicalibration, however, explicitly targets weak subgroups by iteratively identifying and correcting them. As a result, <code>Wearing_Hat=1</code>'s ECE is reduced from <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.13</mn></mrow><annotation encoding="application/x-tex">0.13</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.13</span></span></span></span></span> (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.49</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.49}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.49</span></span></span></span></span></span>) [<a href="#fn11">11</a>] under isotonic calibration to approximately <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.03</mn></mrow><annotation encoding="application/x-tex">0.03</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.03</span></span></span></span></span> (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow> <mstyle mathcolor="red"><mrow><mo>−</mo><mn>0.49</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\,\color{red}{-0.49}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">−</span><span class="mord" style="color: red;">0.49</span></span></span></span></span></span>) [<a href="#fn17">17</a>]. However, the heatmap <a href="#fn18">Fig. 18</a> highlights small regressions for some other groups, further supporting the claim that sequential subgroup corrections can shift miscalibration rather than eliminate it entirely.</p>
<p><a id="fn18"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_11.png" alt="per model per subgroup mse/ece"><br>
<em><strong>Figure 18</strong>. ECE and MSE per model and subgroup with subgroup size overlay</em></p>
<p>Across all calibration methods, accuracy remains largely unchanged (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\pm1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">±</span><span class="mord">1</span></span></span></span></span>%) [<a href="#fn19">Fig. 19</a>], indicating that improved calibration does not directly translate into better classification performance. In contrast, MSE decreases slightly <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\pm10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">±</span><span class="mord">10</span></span></span></span></span>% [<a href="#fn20">20. A</a>], reflecting how the alignment between predicted probabilities and empirical outcomes improves despite decision boundaries remaining effectively unchanged.</p>
<p><a id="fn19"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_10.png" alt="per model per subgroup mse/ece"><br>
<em><strong>Figure 19</strong>. Distribution of subgroup accuracy per model</em></p>
<h2 id="final-integrated-figure">9. Final integrated figure</h2>
<p>Finally, <a href="#fn20">Fig. 20</a> displays 6 subplots to represent visually all data necessary to understand, analyse and explain trends in data and probability predictions through different calibration models.</p>
<p>Note: linear calibration has been omitted from the final analysis due to its irrelevance in calibration: linear calibration is fragile compared to other calibration methods and thus stands very little relevance.</p>
<p><a id="fn20"></a><br>
<img src="https://wurwur.github.io/machine_learning_figs/Figure_12.png" alt="final bs that took too long"><br>
<em><strong>Figure 20</strong>. End-to-end calibration analysis across all models</em></p>
<p>The plots are as follows:</p>
<h3 id="a-top-left">9.A (top left)</h3>
<p>Presents the population MSE of each calibration method (coloured dotted lines), as well as the distribution of MSE of its individual subgroups [<a href="#fn1">1</a>, <a href="#fn8">8</a>, <a href="#fn9">9</a>, <a href="#fn10">10</a>, <a href="#fn11">11</a>, <a href="#fn17">17</a>]. We notice that for each global calibration model, an outlier persists (<code>Wearing_Hat=1</code>), which when going back to the table <a href="#fn">Fig. 7</a>, can be interpreted and justified due to the subgroup’s relative small size.</p>
<h3 id="b-top-middle">9.B (top middle)</h3>
<p>Presents a reliability diagram which graphs the different models [<a href="#fn3">3</a>, <a href="#fn4">4</a>, <a href="#fn5">5</a>, <a href="#fn6">6</a>, <a href="#fn16">16</a>]. It is clear that Multicalibrated is by far the most reliable, and this data is corroborated by its metrics and analysis <a href="#fn18">Fig. 18</a>.</p>
<h3 id="c-top-right">9.C (top right)</h3>
<p>Presents the distribution of predicted probabilities across different models. <code>Uncalibrated GNB</code>, due to its Gaussian nature, tends towards attributing extremes (and thus, the <code>Platt scaling</code>  mimics this trend of having two local extremes through its sigmoid nature).</p>
<p><code>Isotonic</code> and <code>Multicalibrated</code> calibrations, on the other hand, show more archaic probabilities with no obvious trends, further underlying their fine-tuning for each subgroup. Moreover, we suggest that <code>Multicalibration</code>'s distribution of probabilities seems like a slightly modified version of <code>Isotonic</code>'s, which makes sense considering its construction.</p>
<h3 id="d-bottom-left">9.D (bottom left)</h3>
<p>Displays each subgroup ECE violation (with <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.03</mn></mrow><annotation encoding="application/x-tex">0.03</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.03</span></span></span></span></span> as a baseline) for <code>Isotonic</code> and <code>Multicalibrated</code> models. We once again use <code>Isotonic</code> calibration as a baseline, as it has consistently been the most accurate global calibration method. Violations’ intensity are based on the relative degree of the violation: each bar gets darker as it reaches the maximum subgroup ECE across both models, and lighter the closest to the minimal it is.</p>
<p>We notice that <code>Isotonic</code>'s <code>Wearing_Hat=1</code> subgroup was extremely inaccurate, which resulted in considerable loss in MSE, ECE and accuracy. Multicalibration, as it iteratively aims at the subgroup with worst ECE, has (as per our history <a href="#fn14">14</a>, <a href="#fn15">15</a>) targeted that same subgroup <code>Wearing_Hat=1</code> <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">4</span></span></span></span></span> iterations out of <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">5</span></span></span></span></span>, drastically harmonizing subgroup ECE.</p>
<h3 id="e-bottom-middle">9.E (bottom middle)</h3>
<p>Same as <a href="#fn15">Fig. 15</a>, this table displays the evolution &amp; dynamics of data relative to population ECE and worst-group ECE (both measured over <code>X_test</code>) across iterations of the Multicalibration procedure.</p>
<h3 id="f-bottom-right">9.F (bottom right)</h3>
<p>Displays in 3-dimensions the change in population MSE &amp; ECE across iteration of the Multicalibration process [<a href="#fn14">14</a>]. By construction, the Multicalibration aims at reducing the population MSE &amp; ECE values and harmonizing subgroup metrics. However, because some characteristics and labels present a lot of statistical overlap, the subgroup targeted calibration may result in trade-offs between metrics, resulting in unpredictable variations.</p>
<p>As we impose a hard-limit on the number of iterations, it is necessary to display these trade-offs to better understand if we fall in such a situation where some inaccuracy can be justified by the over-fitting of a subgroup.</p>
<blockquote>
<p>Note: it would be sensible in this situation to implement a “scoring” function  based on stochastic factors of all metrics (population ECE, MSE, accuracy, subgroup discrepancy etc) and pick the iteration with highest score as “best Multicalibration iteration”. However, this is beyond the scope of our coursework.</p>
</blockquote>
<p>Here we notice that the last 3 iterations seem to converge at one point around <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>MSE</mtext><mo>≈</mo><mn>0.173</mn></mrow><annotation encoding="application/x-tex">\text{MSE}\approx0.173</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">MSE</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.173</span></span></span></span></span> and <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ECE</mtext><mo>≈</mo><mn>0.01</mn></mrow><annotation encoding="application/x-tex">\text{ECE}\approx0.01</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">ECE</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.01</span></span></span></span></span>.</p>
<h2 id="limitations-and-threats-to-validity">10. Limitations and threats to validity</h2>
<p>Several limitations arise from the scope and constraints of this coursework.</p>
<p>The expected dataset itself is relatively small (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>20</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">n=20{,}000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">20</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">000</span></span></span></span></span>) considering how many attributes and labels we are considering, but necessary to not render embeddings generation too slow.</p>
<p>Furthermore, the datasets are sampled and split over a set random seed (for consistency across runs). Multiple trends and relations between data we have observed through this coursework may not appear on under other sampling configurations.</p>
<blockquote>
<p>Because of the small dataset size and considerable impact of sampling/partitioning configuration on the trends in data and noise, all the figures throughout the report and the initial state of the notebook are based on <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>200</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">n=200{,}000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">200</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">000</span></span></span></span></span> embeddings to ensure stability and consistency.</p>
</blockquote>
<p>Within the data itself, some subgroups were too small to achieve satisfiable metrics, and degraded the general trends, especially for models over-fitting their noise/small sizes (ex: <code>Isotonic</code>). <code>Wearing_Hat=1</code>  (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn><mo separator="true" lspace="0em" rspace="0em">,</mo><mn>423</mn></mrow><annotation encoding="application/x-tex">n=1{,}423</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">1</span><span class="mord"><span class="mpunct">,</span></span><span class="mord">423</span></span></span></span></span>) is the main culprit we have observed and targeted, throughout the coursework, but others may exist.</p>
<p>Finally, as noted in the specifications, MSE and ECE were approximated through thee usage of finite bins, as we cannot compute them exactly.</p>
<h2 id="conclusion">11. Conclusion</h2>
<p>In conclusion:</p>
<ul>
<li>
<p>The uncalibrated GNB presented high ECE (higher is worse) despite reasonable accuracy</p>
</li>
<li>
<p>Global isotonic calibration showed the best population ECE and MSE across global models, but discrepancies between subgroups persist</p>
</li>
<li>
<p>Iterative targeted multicalibration reduced worst subgroup error relative to isotonic, thus harmonizing subgroup discrepancies, but is unpredictable in nature. The finite number of iterations and relative high computational cost of each, arbitrary satisfiability thresholds and risk of significant trade-offs between metrics for marginal improvements render its usage sensitive to design choices.</p>
</li>
</ul>
<h1 id="tables--figures">Tables &amp; Figures</h1>
<p><a href="#fn1">1</a>. Abstract MSE and ECE per model</p>
<p><a href="#fn2">2</a>. Example of smiling label</p>
<p><a href="#fn3">3</a>.Uncalibrated GNB reliability diagram on <code>X_test</code> and <code>X_cal</code></p>
<p><a href="#fn4">4</a>. Linearly calibrated reliability diagram on <code>X_test</code></p>
<p><a href="#fn5">5</a>. Platt calibrated reliability diagram on <code>X_test</code></p>
<p><a href="#fn6">6</a>. Isotonic calibrated reliability diagram on <code>X_test</code></p>
<p><a href="#fn7">7</a>. Subgroup size distribution</p>
<p><a href="#fn8">8</a>. Uncalibrated GNB subgroup metrics</p>
<p><a href="#fn9">9</a>. Linearly calibrated subgroup metrics</p>
<p><a href="#fn10">10</a>. Platt calibrated subgroup metrics</p>
<p><a href="#fn11">11</a>. Isotonic calibrated subgroup metrics</p>
<p><a href="#fn12">12</a>. Subgroup calibration ECE per model</p>
<p><a href="#fn13">13</a>. Subgroup reliability diagram on <code>X_test</code></p>
<p><a href="#fn14">14</a>. Multicalibration history across iterations</p>
<p><a href="#fn15">15</a>. Multicalibration ECE evolution over iterations</p>
<p><a href="#fn16">16</a>. Multicalibration reliability diagram on <code>X_test</code></p>
<p><a href="#fn17">17</a>. Multicalibration subgroup metrics</p>
<p><a href="#fn18">18</a>. ECE and MSE per model and subgroup with subgroup size overlay</p>
<p><a href="#fn19">19</a>. Distribution of subgroup accuracy per model</p>
<p><a href="#fn20">20</a>. End-to-end calibration analysis across all models</p>

    </div>
  </div>
</body>

</html>
